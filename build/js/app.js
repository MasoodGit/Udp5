function FoursquareAPI(){this.clientId="4ZKYMPQ4P0S3NA2JW1ACCJV1IFWEOCEWMRPNQILFFX5VLBS2",this.clientSecret="05EAWPEOHRYCHGUF53J3KW5EJ545R3U1D1GFRHJFEWAD4VUC";var e="https://api.foursquare.com/v2/venues/explore?",o="ll={{lat}},{{lng}}",n="&client_id={{clientId}}&client_secret={{client_secret}}",t="&limit=20&section=topPicks&day=any&time=any&locale=en&v=20150404";e=e+o+n+t,this.getPlaces=function(o,n,t){var a=e.replace(/{{lat}}/g,o.coords.lat).replace(/{{lng}}/g,o.coords.lng).replace(/{{clientId}}/g,this.clientId).replace(/{{client_secret}}/g,this.clientSecret);$.get(a).done(function(e){var o=e.meta;200==o.code?n(e.response):t({errorType:o.errorType,errorDetail:o.errorDetail})}).fail(function(){t("Unable to load places. Please refresh the page")})}}function Neighbourhood(){function e(){r=window.matchMedia("(min-width: 600px)"),r.addListener(i.handleMediaChange),window.innerWidth<=600?i.resolution("lower"):window.innerWidth>600&&i.resolution("high"),n={center:{lat:i.currentLocation.coords.lat,lng:i.currentLocation.coords.lng},disableDefaultUI:!0,zoom:18,zoomControl:!0,zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_BOTTOM,style:google.maps.ZoomControlStyle.DEFAULT},mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.BOTTOM_CENTER}},o=new google.maps.Map(document.getElementById("map"),n),google.maps.event.addDomListener(window,"resize",function(){var e=o.getCenter();google.maps.event.trigger(o,"resize"),o.setCenter(e)}),a=new google.maps.InfoWindow,i.fetchPlaces(),t=new google.maps.places.Autocomplete(document.getElementById("autocomplete")),google.maps.event.addDomListener(t,"place_changed",function(){i.isLoading(!0),i.hasPlaces(!1),i.places([]);var e=t.getPlace();if(e.geometry){var o=e.geometry.location;i.currentLocation.name(e.name),i.currentLocation.coords.lat=o.lat(),i.currentLocation.coords.lng=o.lng(),i.searchPattern(""),i.fetchPlaces()}})}var o,n,t,a,r,i=this,s=[];i.resolution=ko.observable("high"),i.togglePlaceListVisibility=function(){var e=$(".responsive-container");"none"==e.css("display")?e.fadeIn():e.fadeOut()},i.hidePlaceList=function(){$(".responsive-container").fadeOut()},i.showPlaceList=function(){$(".responsive-container").fadeIn()},i.slideDown=function(){var e=$(".places");e.slideDown("slow")},i.slideUp=function(){var e=$(".places");e.slideUp("slow")},i.slideToggle=function(){var e=$(".places");e.slideToggle("slow");var o=$(".collapse-place-list"),n=o.find("span");"down-arrow"==n.get(0).className?(n.removeClass("down-arrow"),n.addClass("up-arrow")):(n.removeClass("up-arrow"),n.addClass("down-arrow"))},i.handleMediaChange=function(e){e.matches?(i.showPlaceList(),i.resolution("high")):(i.hidePlaceList(),i.resolution("lower"))},i.foursquareAPI=new FoursquareAPI,i.isLoading=ko.observable(!0),i.isErrored=ko.observable(!1),i.errorMessage=ko.observable(!1),i.searchPattern=ko.observable(""),i.places=ko.observableArray(),i.hasPlaces=ko.observable(!1),i.currentLocation={name:ko.observable("Bangalore"),coords:{lat:12.9738,lng:77.6119}},i.pantoLocation=function(){o.panTo(i.currentLocation.coords),o.setZoom(18)},i.clearSearch=function(){i.searchPattern(""),i.slideDown()},i.showInfoWindow=function(e){o.panTo(e.marker.position),a.setContent(i.getInfoWindowContent(e)),a.open(o,e.marker),"lower"==i.resolution()&&i.hidePlaceList()},i.getInfoWindowContent=function(e){var o="";e.location.formattedAddress.length>0&&e.location.formattedAddress.forEach(function(e){o+=" "+e});var n=e.rating,t=e.ratingColor,a=e.categoryName(),r=s[e.categoryIcon()],i="";i='<div class="infowindow-block"><div class="infowindow-icon"></div>',i+='<div class="infowindow-details"><div class="infowindow-venue-name"><span>'+e.name+'</span></div><div class="infowindow-venue-score" style="background: #'+t+';">'+n+"</div>",i+='<div class="infowindow-venue-AddressData"><div class ="infowindow-venue-address">'+o+"</div>",i+='<div class="infowindow-venue-data"><span class="venueDataItem"><span class="categoryName">'+a+"</span></span>",i+="</div></div></div></div>";var l=$(i);return l.find("div.infowindow-icon").append(r),l.html()},i.fetchPlaces=function(){i.foursquareAPI.getPlaces(i.currentLocation,function(e){var n=e.groups[0].items;if(n.length<=0)return void i.isLoading(!1);var t=e.suggestedBounds;if(void 0!==t){var r=new google.maps.LatLngBounds(new google.maps.LatLng(t.sw.lat,t.sw.lng),new google.maps.LatLng(t.ne.lat,t.ne.lng));o.fitBounds(r)}n.forEach(function(e){var n=e.venue;n.isMatched=ko.computed(function(){a.close();for(var e=i.searchPattern().toLowerCase(),o=n.categories.length,t=0;o>t;++t)if(-1!=n.categories[t].name.toLowerCase().search(e))return!0;return n.name.substring(0,e.length).toLowerCase()===e}),n.categoryName=ko.computed(function(){return n.categories.length<=0?"":n.categories[0].name?n.categories[0].name:""}),n.categoryIcon=ko.computed(function(){if(n.categories.length<=0)return"";if(!n.categories[0].icon)return"";var e=n.categories[0].icon.prefix,o=32,t=n.categories[0].icon.suffix,a=e+"bg_"+o+t;return s.push(a),a}),n.marker=new google.maps.Marker({map:o,title:n.name,position:{lat:n.location.lat,lng:n.location.lng}}),n.isMarkerVisible=ko.computed(function(){n.marker.setVisible(n.isMatched())}),google.maps.event.addListener(n.marker,"click",function(){a.setContent(i.getInfoWindowContent(n)),a.open(o,n.marker),document.getElementById(n.id).scrollIntoView()}),i.places.push(n)}),i.hasPlaces(!0),s.forEach(function(e){var o=new Image;o.onload=function(){s[e]=o},o.src=e}),i.isLoading(!1)},i.errorHandler)},i.errorHandler=function(e){i.isLoading(!1),e&&(console.log("Error occured...",e),"object"==typeof e?i.errorMessage("Can not retrieve all the places. Please reload the page."):"string"==typeof e&&i.errorMessage(e)),i.isErrored(!0)};try{e()}catch(l){i.errorHandler(l)}}$(document).ready(function(){ko.applyBindings(new Neighbourhood),WebFontConfig={google:{families:["Roboto:100,300,400:latin"]}},function(){var e=document.createElement("script");e.src=("https:"==document.location.protocol?"https":"http")+"://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js",e.type="text/javascript",e.async="true";var o=document.getElementsByTagName("script")[0];o.parentNode.insertBefore(e,o)}()});