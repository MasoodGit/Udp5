function FoursquareAPI(){this.clientId="4ZKYMPQ4P0S3NA2JW1ACCJV1IFWEOCEWMRPNQILFFX5VLBS2",this.clientSecret="05EAWPEOHRYCHGUF53J3KW5EJ545R3U1D1GFRHJFEWAD4VUC";var e="https://api.foursquare.com/v2/venues/explore?",o="ll={{lat}},{{lng}}",t="&client_id={{clientId}}&client_secret={{client_secret}}",n="&limit=50&section=topPicks&day=any&time=any&locale=en&v=20150404";e=e+o+t+n,this.getPlaces=function(o,t,n){var a=e.replace(/{{lat}}/g,o.coords.lat).replace(/{{lng}}/g,o.coords.lng).replace(/{{clientId}}/g,this.clientId).replace(/{{client_secret}}/g,this.clientSecret);$.get(a).done(function(e){var o=e.meta;200==o.code?t(e.response):n({errorType:o.errorType,errorDetail:o.errorDetail})}).fail(function(){n("Unable to load places. Please refresh the page")})}}function Neighbourhood(){function e(){i=$('script[data-template="infowindowTemplate"]').html(),t={center:{lat:r.currentLocation.coords.lat,lng:r.currentLocation.coords.lng},disableDefaultUI:!0,zoom:18,zoomControl:!0,zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_BOTTOM,style:google.maps.ZoomControlStyle.SMALL},mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.RIGHT_BOTTOM}},o=new google.maps.Map(document.getElementById("map"),t),a=new google.maps.InfoWindow,r.fetchPlaces(),n=new google.maps.places.Autocomplete(document.getElementById("autocomplete")),google.maps.event.addDomListener(n,"place_changed",function(){r.isLoading(!0),r.places([]);var e=n.getPlace();if(e.geometry){var o=e.geometry.location;r.currentLocation.name(e.name),r.currentLocation.coords.lat=o.lat(),r.currentLocation.coords.lng=o.lng(),r.searchPattern(""),r.fetchPlaces()}})}var o,t,n,a,r=this,i="";r.foursquareAPI=new FoursquareAPI,r.isLoading=ko.observable(!0),r.isErrored=ko.observable(!1),r.errorMessage=ko.observable(!1),r.searchPattern=ko.observable(""),r.places=ko.observableArray([]),r.filteredPlacesList=ko.observableArray([]),r.currentLocation={name:ko.observable("Bangalore"),coords:{lat:12.9738,lng:77.6119}},r.places=ko.observableArray([]),r.pantoLocation=function(){o.panTo(r.currentLocation.coords),o.setZoom(18)},r.clearSearch=function(){r.searchPattern("")},r.showInfoWindow=function(e){o.panTo(e.marker.position),a.setContent(r.getInfoWindowContent(e)),a.open(o,e.marker)},r.getInfoWindowContent=function(e){var o="";e.location.formattedAddress.length>0&&e.location.formattedAddress.forEach(function(e){o+=" "+e});var t=e.rating,n=e.ratingColor,a=e.categoryName(),r=e.categoryIcon(),i="";return i='<div class="infowindow-block"><div class="infowindow-icon"><img class="icon" src="'+r+'"></div>',i+='<div class="infowindow-details"><div class="infowindow-venue-name"><span>'+e.name+'</span></div><div class="infowindow-venue-score" style="background: #'+n+';">'+t+"</div>",i+='<div class="infowindow-venue-AddressData"><div class ="infowindow-venue-address">'+o+"</div>",i+='<div class="infowindow-venue-data"><span class="venueDataItem"><span class="categoryName">'+a+"</span></span>",i+="</div></div></div></div>"},r.fetchPlaces=function(){r.foursquareAPI.getPlaces(r.currentLocation,function(e){var t=e.groups[0].items;if(t.length<=0)return void r.isLoading(!1);var n=e.suggestedBounds;if(void 0!==n){var i=new google.maps.LatLngBounds(new google.maps.LatLng(n.sw.lat,n.sw.lng),new google.maps.LatLng(n.ne.lat,n.ne.lng));o.fitBounds(i)}t.forEach(function(e){var t=e.venue;t.isMatched=ko.computed(function(){a.close();for(var e=r.searchPattern().toLowerCase(),o=0;o<t.categories.length;++o)if(-1!=t.categories[o].name.toLowerCase().search(e))return!0;return t.name.substring(0,e.length).toLowerCase()===e}),t.categoryName=ko.computed(function(){return t.categories.length<=0?"":t.categories[0].name?t.categories[0].name:""}),t.categoryIcon=ko.computed(function(){if(t.categories.length<=0)return"";if(!t.categories[0].icon)return"";var e=t.categories[0].icon.prefix,o=32,n=t.categories[0].icon.suffix;return e+"bg_"+o+n}),t.marker=new google.maps.Marker({map:o,title:t.name,position:{lat:t.location.lat,lng:t.location.lng}}),t.isMarkerVisible=ko.computed(function(){t.marker.setVisible(t.isMatched())}),google.maps.event.addListener(t.marker,"click",function(){a.setContent(r.getInfoWindowContent(t)),a.open(o,t.marker),document.getElementById(t.id).scrollIntoView()}),r.places.push(t)}),r.isLoading(!1)},r.errorHandler)},r.errorHandler=function(e){r.isLoading(!1),e&&(console.log("Error occured...",e),"object"==typeof e?r.errorMessage("Can not retrieve all the places. Please reload the page."):"string"==typeof e&&r.errorMessage(e)),r.isErrored(!0)};try{e()}catch(s){r.errorHandler(s)}}$(document).ready(function(){ko.applyBindings(new Neighbourhood),WebFontConfig={google:{families:["Roboto:100,300,400:latin"]}},function(){var e=document.createElement("script");e.src=("https:"==document.location.protocol?"https":"http")+"://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js",e.type="text/javascript",e.async="true";var o=document.getElementsByTagName("script")[0];o.parentNode.insertBefore(e,o)}()});